<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motion Video Player (Debug)</title>
<style>
  body { margin: 0; background: black; overflow: hidden; }
  video#player { width: 100vw; height: 100vh; object-fit: cover; }
  #cam { display: none; }

  /* Debug overlay */
  #debug {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.6);
    color: #0f0;
    padding: 10px;
    font-family: monospace;
    font-size: 14px;
    border-radius: 6px;
    z-index: 9999;
  }
</style>
</head>
<body>

<div id="debug">Initializing…</div>

<!-- Hidden camera feed -->
<video id="cam" autoplay playsinline></video>

<!-- Your video -->
<video id="player" playsinline preload="auto" muted>
  <source src="yourvideo.mp4" type="video/mp4">
</video>

<script>
const cam = document.getElementById('cam');
const player = document.getElementById('player');
const debug = document.getElementById('debug');

let lastFrame;
let motionTimer = null;

// Ask for camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
  .then(stream => cam.srcObject = stream)
  .catch(err => alert("Camera access failed: " + err));

// Create canvas for frame comparison
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

// iOS autoplay fix
player.load();

// Adjustable sensitivity
let THRESHOLD = 120000;  // MUCH lower than before

function detectMotion() {
  if (cam.videoWidth === 0) {
    debug.innerText = "Waiting for camera…";
    requestAnimationFrame(detectMotion);
    return;
  }

  canvas.width = cam.videoWidth;
  canvas.height = cam.videoHeight;

  ctx.drawImage(cam, 0, 0);
  const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);

  let diff = 0;

  if (lastFrame) {
    for (let i = 0; i < frame.data.length; i += 4) {
      diff += Math.abs(frame.data[i] - lastFrame.data[i]);
    }

    // Debug output
    debug.innerText = 
      "Motion: " + diff + "\n" +
      "Threshold: " + THRESHOLD + "\n" +
      (diff > THRESHOLD ? "MOTION DETECTED" : "no motion");

    if (diff > THRESHOLD) {
      player.play();
      clearTimeout(motionTimer);
      motionTimer = setTimeout(() => player.pause(), 3000);
    }
  }

  lastFrame = frame;
  requestAnimationFrame(detectMotion);
}

detectMotion();
</script>

</body>
</html>
