<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motion Video Player</title>
<style>
  body { margin: 0; background: black; overflow: hidden; }
  video#player { width: 100vw; height: 100vh; object-fit: cover; }
  #cam { display: none; }
</style>
</head>
<body>

<!-- Hidden camera feed -->
<video id="cam" autoplay playsinline></video>

<!-- Your video -->
<video id="player" playsinline preload="auto" muted>
  <source src="yourvideo.mp4" type="video/mp4">
</video>

<script>
const cam = document.getElementById('cam');
const player = document.getElementById('player');

let lastFrame;
let motionTimer = null;

// Ask for camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
  .then(stream => cam.srcObject = stream)
  .catch(err => alert("Camera access failed: " + err));

// Create canvas for frame comparison
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

// iOS autoplay fix: load video immediately
player.load();

function detectMotion() {
  if (cam.videoWidth === 0) {
    requestAnimationFrame(detectMotion);
    return;
  }

  canvas.width = cam.videoWidth;
  canvas.height = cam.videoHeight;

  ctx.drawImage(cam, 0, 0);
  const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);

  if (lastFrame) {
    let diff = 0;
    for (let i = 0; i < frame.data.length; i += 4) {
      diff += Math.abs(frame.data[i] - lastFrame.data[i]);
    }

    // Motion threshold â€” tweak if needed
    if (diff > 2000000) {
      player.play();
      clearTimeout(motionTimer);
      motionTimer = setTimeout(() => player.pause(), 3000);
    }
  }

  lastFrame = frame;
  requestAnimationFrame(detectMotion);
}

detectMotion();
</script>

</body>
</html>
